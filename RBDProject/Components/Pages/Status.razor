@using RBDProject.Models;
@page "/Estados"

@rendermode InteractiveServer

@inject IHttpClientFactory _http
@inject IJSRuntime _jSRuntime
@inject IConfiguration? _configure
@inject NotificationService _notificationService
@inject TooltipService _tooltipService
@inject NavigationManager _navigate

<PageTitle>Estados</PageTitle>

<AuthorizeView Roles="@(_configure?.GetValue<string>("Permisos:Administrador"))">
    <NotAuthorized>
        @if (context.User.Identity?.IsAuthenticated == null)
        {
            _navigate.NavigateTo("/");
        }
        else
        {
            <p>No estas autorizado</p>
        }
    </NotAuthorized>
    <Authorized>
        <section>
            <div class="sticky-bottom p-2 gap-2">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                        @onclick="@(() => SendTypeModal(new RbdEstado(), "add"))">
                    <i class="bi bi-plus-circle bi-sm mr-2 text-gray-400"></i>
                    Agregar
                </button>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#idReporte">
                    <i class="bi bi-printer mr-2 text-gray-400"></i>
                    Imprimir
                </button>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#idExportar">
                    <i class="bi bi-box-arrow-up-right"></i>
                    Exportar
                </button>
            </div>

            @* SECCION DE TABLA *@
            <section>
                <RadzenDataGrid AllowFiltering="true" AllowColumnResize="true" AllowAlternatingRows="false" FilterMode="FilterMode.Advanced" AllowSorting="true" PageSize="5" AllowPaging="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true"
                                Data="@estados" GridLines=DataGridGridLines.Both ColumnWidth="300px" LogicalFilterOperator="LogicalFilterOperator.Or" SelectionMode="DataGridSelectionMode.Multiple" @bind-Value=@_selectedEstados>
                    <Columns>
                        <RadzenDataGridColumn Title="Opciones" Width="200px" Frozen=true Filterable="false" Sortable="false">
                            <Template Context="Options">
                                <RadzenButton Icon="error" ButtonStyle="ButtonStyle.Success" Click="@(() => SendTypeModal(Options, "info"))" data-bs-toggle="modal" data-bs-target="#staticBackdrop" MouseEnter="@((args) => ShowTooltip(args, "Informacion"))"></RadzenButton>
                                <RadzenButton Icon="Edit" ButtonStyle="ButtonStyle.Primary" Click="@(() => SendTypeModal(Options, "update"))" data-bs-toggle="modal" data-bs-target="#staticBackdrop" MouseEnter="@((args) => ShowTooltip(args, "Editar"))"></RadzenButton>
                                <RadzenButton Icon="delete" Disabled=@(Options.CodEst <= 7) ButtonStyle="ButtonStyle.Danger" Click="@(() => SendTypeModal(Options, "delete"))" data-bs-toggle="modal" data-bs-target="#exampleModal" MouseEnter="@((args) => ShowTooltip(args, "Eliminar"))"></RadzenButton>
                                <RadzenButton Icon="Print" Disabled=true ButtonStyle="ButtonStyle.Primary"></RadzenButton>
                            </Template>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn Property="@nameof(RbdEstado.CodEst)" Filterable="false" Frozen="true" Title="ID" Width="80px" TextAlign="TextAlign.Center" />
                        <RadzenDataGridColumn Property="@nameof(RbdEstado.NomEst)" Title="Nombre" Width="160px" />
                        <RadzenDataGridColumn Property="@nameof(RbdEstado.Descripcion)" Title="Descripcion" />
                    </Columns>
                </RadzenDataGrid>
            </section>
        </section>
    </Authorized>
</AuthorizeView>


@* COMPONENTE MODELO *@
<RBDProject.Components.Modals.Modal_Estado modelo="model" SendTypeModal="@((m) => SendTypeModal(m.Item1, m.Item2))" utility="@utilitymodal" UpdateModel="Update" DeleteModel="Remove" AddModel="Add"></RBDProject.Components.Modals.Modal_Estado>


<RBDProject.Components.Modals.ModalSelectReporte CountGeneral=@(estados.Count) CountList="@(_selectedEstados.Count)" OpcionReporte="ImprimirReporte"></RBDProject.Components.Modals.ModalSelectReporte>


<RBDProject.Components.Modals.ModalExportar CountGeneral=@(estados.Count) CountList="@(_selectedEstados.Count)" OpcionExport="@((a) => ExportarDocumento(a.Item1, a.Item2))"></RBDProject.Components.Modals.ModalExportar>

